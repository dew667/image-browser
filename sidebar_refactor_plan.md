# 侧边栏目录重构方案

## 概述
将当前基于文件系统的目录树重构为智能图片管理系统，提供最近浏览、收藏图片等智能分类功能。

## 新目录结构

### 智能目录分类
```
📁 智能目录
├── ⏱️ 最近浏览 (Recent)
├── ❤️ 收藏图片 (Favorites)
├── 📥 保存的图片 (Saved)
├── 🏷️ 标签分类 (Tags)
├── 📅 按日期分类 (By Date)
└── 🗂️ 传统目录 (Folders) - 可选保留
```

## 数据存储设计

### 配置文件位置
```
~/.image-browser/
├── recent.json          # 最近浏览记录
├── favorites.json       # 收藏图片列表
├── saved.json          # 保存的图片列表
├── tags.json           # 标签分类
├── settings.json       # 用户设置
└── cache/              # 缩略图缓存
```

### 数据格式规范

#### recent.json
```json
{
  "recent_images": [
    {
      "path": "/Users/photos/vacation/beach.jpg",
      "last_viewed": "2024-07-27T14:30:00Z",
      "view_count": 5
    }
  ],
  "max_items": 50
}
```

#### favorites.json
```json
{
  "favorites": [
    {
      "path": "/Users/photos/family/dog.jpg",
      "added_date": "2024-07-26T10:15:00Z",
      "tags": ["pet", "family"]
    }
  ]
}
```

## 功能模块设计

### 1. 最近浏览模块
- **功能**: 记录最近查看的图片，按时间倒序排列
- **容量**: 默认保存最近50张图片
- **去重**: 同一图片多次查看只保留最新记录
- **持久化**: 实时写入JSON文件

### 2. 收藏模块
- **功能**: 用户可收藏喜欢的图片
- **操作**: 右键菜单或快捷键 (Ctrl+D)
- **存储**: 保存图片路径和收藏时间
- **同步**: 支持导入/导出收藏列表

### 3. 保存的图片
- **功能**: 用户编辑后的图片保存位置
- **路径**: 可配置默认保存目录
- **组织**: 按日期自动创建子目录
- **命名**: 支持自定义命名规则

### 4. 标签系统
- **功能**: 为图片添加自定义标签
- **管理**: 支持标签的增删改查
- **过滤**: 按标签快速筛选图片
- **云同步**: 可选的标签云同步功能

### 5. 日期分类
- **自动分类**: 按拍摄/修改日期自动分组
- **视图**: 支持年/月/日三级视图
- **统计**: 显示每个时间段的照片数量

## UI/UX 设计

### 侧边栏布局
```
┌─────────────────────────────────┐
│  📷 Image Browser              │
├─────────────────────────────────┤
│ 智能目录                        │
│ ⏱️ 最近浏览 (12)               │
│ ❤️ 收藏图片 (8)                │
│ 📥 保存的图片 (5)              │
│ 🏷️ 标签分类                    │
│   ├── 风景 (3)                 │
│   ├── 人物 (7)                 │
│   └── 建筑 (2)                 │
│ 📅 按日期分类                  │
│   ├── 2024年7月 (15)           │
│   └── 2024年6月 (23)           │
│ 🗂️ 传统目录                    │
└─────────────────────────────────┘
```

### 交互设计
- **悬停提示**: 显示图片预览和基本信息
- **右键菜单**: 快速添加到收藏/标签
- **拖拽支持**: 拖拽图片到标签进行分类
- **快捷键**: 
  - `Ctrl+H` 显示/隐藏传统目录
  - `Ctrl+D` 添加到收藏
  - `Ctrl+T` 添加标签

## 技术实现架构

### 数据管理模块
```rust
// 定义核心数据结构
struct SmartDirectory {
    recent: RecentManager,
    favorites: FavoritesManager,
    saved: SavedManager,
    tags: TagManager,
    date_classifier: DateClassifier,
}

// 最近浏览管理器
struct RecentManager {
    items: Vec<RecentItem>,
    max_items: usize,
}

// 收藏管理器
struct FavoritesManager {
    items: Vec<FavoriteItem>,
}
```

### 缓存策略
- **缩略图缓存**: 使用LRU算法，限制缓存大小
- **元数据缓存**: 图片EXIF信息缓存
- **内存管理**: 定期清理过期缓存

### 性能优化
- **异步加载**: 目录内容异步加载，避免阻塞UI
- **分页显示**: 大量图片时分页加载
- **索引优化**: 为常用查询建立索引

## 扩展功能

### 智能推荐
- **基于时间**: 推荐同时间段拍摄的照片
- **基于位置**: 推荐同地点拍摄的照片
- **基于内容**: 使用AI识别相似图片

### 搜索功能
- **全文搜索**: 支持文件名、标签、EXIF信息搜索
- **高级筛选**: 按日期、大小、类型等条件筛选
- **搜索历史**: 保存常用搜索条件

### 云同步
- **配置同步**: 收藏、标签等元数据云同步
- **多设备支持**: 跨设备访问相同组织结构
- **备份恢复**: 支持数据备份和恢复

## 迁移方案

### 用户数据迁移
- **自动检测**: 首次启动时检测旧版本数据
- **平滑迁移**: 自动转换现有收藏到新格式
- **备份机制**: 迁移前自动创建数据备份

### 兼容性考虑
- **向后兼容**: 保留传统目录作为可选功能
- **配置兼容**: 保留用户现有设置
- **渐进升级**: 分阶段引入新功能

## 配置选项

### 用户偏好设置
```json
{
  "sidebar": {
    "show_traditional_folders": false,
    "default_section": "recent",
    "max_recent_items": 50,
    "auto_tag_enabled": true,
    "thumbnail_size": 80
  }
}
```

### 高级设置
- **自定义目录**: 允许用户添加自定义智能目录
- **插件系统**: 支持第三方扩展智能目录功能
- **API接口**: 提供API供其他应用集成

## 实施步骤

1. **第一阶段**: 实现基础数据结构和管理器
2. **第二阶段**: 开发UI组件和交互逻辑
3. **第三阶段**: 添加缓存和性能优化
4. **第四阶段**: 实现扩展功能和云同步
5. **第五阶段**: 用户测试和反馈收集

这个重构方案将传统的文件系统目录转变为以用户为中心的智能图片管理系统，提供更直观、高效的图片浏览体验。
